<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ad Viewer</title>
  <style>
  
    #adFrame {
      width: 100vw;
      height: 100vh;
      border: none;
    }
    #skipBtn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      background-color: #8e2de2;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      display: none;
      z-index: 1000;
    }

    body {
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center; /* عمودي */
  align-items: center;     /* أفقي */
  font-family: Arial, sans-serif;
  text-align: center;
  background: #f9f9f9;
}

h2 {
  margin: 0 0 10px 0;
  font-size: 28px;
  color: #333;
}

p {
  margin: 0 0 15px 0;
  font-size: 18px;
  color: #666;
}

#countdown {
  font-size: 36px;
  font-weight: bold;
  color: #007bff;
}
  </style>
</head>
<body>
    <style>
  #openNow {
    position: fixed;   /* يثبت الزر أسفل الشاشة */
    bottom: 20%;       /* مسافة من الأسفل 20% */
    left: 50%;         /* منتصف الشاشة أفقيًا */
    transform: translateX(-50%); /* لضبطه تمامًا في المنتصف */
    padding: 12px 24px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: linear-gradient(135deg, purple, lightpink);
    color: white;
    cursor: pointer;
  }
</style>

<button id="openNow">فتح الآن</button>
<p id="statusMsg"></p>

  <div id="waitText" style="
  position:fixed;top:20%;left:50%;
  transform:translateX(-50%);
  font-size:20px;text-align:center;
  background:#000;color:#fff;
  padding:10px 15px;border-radius:10px;
  display:none;">
  </div>
   <!--   هنا العرض   -->
  <h2>انتهت الدفعة</h2>
  <p>المدة المتبقية قبل الدفعة التالية:</p>
  <h1 id="countdown">--:--</h1>

  <script src="script.js"></script>
</body>
</html>

    <script>
        //التحقق من تسجيل الدخول 
if (localStorage.getItem("isLoggedIn") !== "true") {
    window.location.href = "index.html"; // يفتح صفحة تسجيل الدخول
}
    </script>
  

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>
<script>
    // إعداد Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBhOhK3yCv4p-dhfXYx-w1aRB19a-VpRKY",
        authDomain: "swapio-30675.firebaseapp.com",
        projectId: "swapio-30675",
        storageBucket: "swapio-30675.appspot.com",
        messagingSenderId: "936588847751",
        appId: "1:936588847751:web:81aa27a8a12fc6d6a06622",
        measurementId: "G-L4RH076S6H",
        databaseURL: "https://swapio-30675-default-rtdb.firebaseio.com"
    };

    // تفعيل Firebase
    firebase.initializeApp(firebaseConfig);

    // التأكد من أن المستخدم مسجل الدخول
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            const userEmail = user.email;
            const firstLetter = userEmail.charAt(0).toUpperCase();
            console.log("Email:", userEmail);
            console.log("First letter:", firstLetter);
        } else {
            // 🚀 إعادة توجيه المستخدم إلى index.html لو غير مسجل دخول
            window.location.href = "index.html";
        }
    });
</script>

<!--// ============= // الكود الأصلي الذي يستدعي كل الأجزاء // ============//-->

  <!-- 01 - أدوات عشوائية (random helpers) -->
<script>
// هذا كود: دوال مساعدة للأعداد العشوائية والزمن
function randomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function randomMs(minSec, maxSec) {
  // يعيد الزمن بالملّي ثانية
  return randomInt(minSec, maxSec) * 1000;
}
</script>

<script>
// ===== وحدة إدارة وقت الانتظار في localStorage (موحد المفتاح) =====
const WAIT_KEY = 'waitEndTime';

function saveWaitEndTime(ms) {
  const endTime = Date.now() + ms;
  localStorage.setItem(WAIT_KEY, String(endTime));
  return endTime;
}

function getWaitEndTime() {
  const raw = localStorage.getItem(WAIT_KEY);
  return raw ? parseInt(raw, 10) : 0;
}

function getRemainingWait() {
  const end = getWaitEndTime();
  const rem = end ? end - Date.now() : 0;
  return rem > 0 ? rem : 0;
}

function clearWaitEndTime() {
  localStorage.removeItem(WAIT_KEY);
}
</script>

  

<!-- 02 - تعريف الشركات والروابط -->
<script>
// هذا كود: تعريف قائمة الشركات والروابط (مصدر الإعلانات)
const companies = {
  adstera:    ["https://www.adstera.com"],
  popads:     ["https://www.popads.com"],
  hilltop:    ["https://www.hilltop.com"],
  propeller:  ["https://www.propeller.com"],
  mediahub:   ["https://www.mediahub.com"],
  yllix:      ["https://www.yllix.com"],
  bidvertiser:["https://www.bidvertiser.com"],
  clickadu:   ["https://www.clickadu.com"],
  adcash:     ["https://www.adcash.com"],
  admaven:    ["https://www.admaven.com"]
};
</script>

<!-- 03 - الإعدادات والمتغيرات العامة -->
<script>
// هذا كود: متغيرات الحالة العامة وإعداداتها
let lastFive = [];
let batchCount = 0;                       // متغير حالة عام
let banEvery = randomInt(2, 5);           // بعد كم دفعة يحصل الحظر الطويل
const adHistory = [];
let countdownActive = false;
let restEvery = randomInt(4, 8);          // بعد كم دفعات تظهر الراحة القصيرة (4-8)

// متغير لمتابعة آخر نافذة إعلان مفتوحة (يستخدمه openAd/waitInsideAd)
let lastOpenedAdWin = null;
</script>

<!-- 04 - فترات الراحة والحظر (الزمنيات) -->
<script>
// هذا كود: دوال تعيد فترات الراحة القصيرة والحظر الطويل
function getRestPeriod() {
  // راحة قصيرة: 2-3 دقائق
  return randomInt(2, 3) * 60 * 1000;
}

function getBanPeriod() {
  // حظر طويل: بين 60 و120 دقيقة
  const min = Math.floor(1 * 60), max = Math.floor(2 * 60);
  return randomInt(min, max) * 60 * 1000;
}
</script>

<!-- 05 - سجل الإعلانات ومنع التكرار -->
<script>
// هذا كود: تسجيل الإعلانات الحديثة ومنع إعادة عرض نفس الشركة خلال نافذة زمنية
function canShowAd(company) {
  const now = Date.now();
  const recent = adHistory.filter(e => now - e.time < 55 * 1000); // 10 دقائق
  if (recent.some(e => e.company === company)) return false;
  return true;
}

function registerAd(company) {
  adHistory.push({ company, time: Date.now() });
  if (adHistory.length > 100) adHistory.shift();
}
</script>


<script>
/* منع تشغيل متكرر */
window.__adRunner = window.__adRunner || { isRunning: false };
</script>


<!-- 06 - اختيار شركة/رابط عشوائي -->
<script>
// هذا كود: اختيار شركة بشكل عشوائي مع تجنب آخر 5 شركات
function getRandomCompany() {
  let keys = Object.keys(companies).filter(c => !lastFive.includes(c));
  if (keys.length === 0) {
    lastFive = [];
    keys = Object.keys(companies);
  }
  const pick = keys[randomInt(0, keys.length - 1)];
  lastFive.push(pick);
  if (lastFive.length > 5) lastFive.shift();
  return pick;
}
</script>

<!-- 07 - تغليف مكافآت (calls safe) -->
<script>
// هذا كود: تغليف استدعاءات الدوال (وجودها اختياري) حتى لا يتوقف الكود
async function callAddRewardIfExists() {
  if (typeof addReward === 'function') try { await addReward(); } catch(e) { console.error('addReward error', e); }
}
async function callAddWatchedAdIfExists() {
  if (typeof addWatchedAd === 'function') try { await addWatchedAd(); } catch(e) { console.error('addWatchedAd error', e); }
}
async function callAddDailyRewardIfExists() {
  if (typeof addDailyReward === 'function') try { await addDailyReward(); } catch(e) { console.error('addDailyReward error', e); }
}
</script>

<!-- 08 - تشغيل دفعة الإعلانات (core runBatch) -->

<script>
// Utility: حارس عبر التبويبات (localStorage) لمنع تشغيل متزامن بين تبويبات
const GLOBAL_RUN_KEY = 'adRunner_active_until'; // يخزن timestamp انتهاء عمل العَلم
function setGlobalRunnerLock(msFromNow) {
  const until = Date.now() + Math.max(5000, msFromNow || 5000); // at least 5s
  localStorage.setItem(GLOBAL_RUN_KEY, String(until));
}
function clearGlobalRunnerLock() {
  localStorage.removeItem(GLOBAL_RUN_KEY);
}
function isGlobalRunnerLocked() {
  const raw = localStorage.getItem(GLOBAL_RUN_KEY);
  if (!raw) return false;
  const until = parseInt(raw, 10);
  if (isNaN(until)) return false;
  if (Date.now() > until) { clearGlobalRunnerLock(); return false; }
  return true;
}

// RunBatch محصّن ومصحح
async function runBatchProtected() {
  if (window.__adRunner?.isRunning) {
    console.warn('Runner already active in this tab — aborting.');
    return;
  }
  if (isGlobalRunnerLocked()) {
    console.warn('Runner locked by another tab — aborting.');
    return;
  }

  window.__adRunner = window.__adRunner || {};
  window.__adRunner.isRunning = true;
  // lock across tabs for 60s (يُجدَّد لاحقًا إذا استدعى الحاجة)
  setGlobalRunnerLock(60 * 1000);

  let adsOpened = 0;
  const MAX_ADS = 200;

  try {
    const hour = new Date().getHours();
    const size = (hour >= 1 && hour < 6) ? 3 : randomInt(10, 15);

    console.log('runBatchProtected START, size=', size, 'hour=', hour);

    const urls = [];
    for (let j = 0; j < size; j++) {
      let comp = getRandomCompany();
      // إذا أردت إزالة منطق canShowAd: عيّن الشرط false أو علّق السطر
      if (typeof canShowAd === 'function' && !canShowAd(comp)) { j--; continue; }
      const urlList = companies[comp];
      const url = urlList[randomInt(0, urlList.length - 1)];
      if (typeof registerAd === 'function') registerAd(comp);
      urls.push({ comp, url });
    }

    for (let i = 0; i < urls.length; i++) {
      if (adsOpened++ > MAX_ADS) {
        console.error('Watchdog abort: opened too many ads');
        break;
      }

      const { comp, url } = urls[i];
      console.log('Opening ad', i+1, '/', urls.length, url);
      const win = window.open(url, '_blank', 'noopener,noreferrer');
      if (!win) console.warn('Popup blocked or failed to open:', url);

      await callAddRewardIfExists();
      await callAddWatchedAdIfExists();
      await callAddDailyRewardIfExists();

      await new Promise(r => setTimeout(r, randomMs(10, 17)));

      try { if (win && !win.closed) win.close(); } catch(e) { console.warn('close error', e); }

      if (i < urls.length - 1) await new Promise(r => setTimeout(r, randomMs(0, 4)));
      // تمديد القفل عبر التبويبات لمدّة قصيرة أثناء العمل
      setGlobalRunnerLock(30 * 1000);
    }

    // حساب الانتظار بين الدفعات (كما سبق)
    batchCount++;
    let waitTime = randomMs(3 * 60, 8 * 60);
    if (hour >= 1 && hour < 6) {
      waitTime += 50 * 60 * 1000;
    } else if (batchCount >= banEvery) {
      waitTime += getBanPeriod();
      batchCount = 0;
      banEvery = randomInt(2, 5);
      restEvery = randomInt(4, 8);
    } else if (batchCount % restEvery === 0) {
      waitTime += getRestPeriod();
      restEvery = randomInt(4, 8);
    } else {
      waitTime += getRestPeriod();
      restEvery = randomInt(4, 8);
    }

    // حفظ و إعادة توجيه
    saveWaitEndTime(waitTime);
    // تأكيد إزالة القفل المحلي قبل الانتقال
    clearGlobalRunnerLock();
    window.location.href = 'redirect.html';
    return waitTime;
  } catch (err) {
    console.error('runBatchProtected error', err);
  } finally {
    // تأكد أنّ العلم يعود false حتى لو حدث خطأ
    window.__adRunner.isRunning = false;
    clearGlobalRunnerLock();
    console.log('runBatchProtected FINISHED');
  }
}

// إذا تريد استخدام mainAdFlow يمكن استدعاؤه كمجرّد غلاف:
async function mainAdFlowWrapper() {
  return runBatchProtected();
}
                  </script>

<!-- 09 - العد التنازلي وlocalStorage -->


  <script>

function getWaitEndTime() {
  const r = localStorage.getItem(WAIT_KEY);
  return r ? parseInt(r, 10) : 0;
}

function getRemainingWait() {
  const e = getWaitEndTime();
  const rem = e ? e - Date.now() : 0;
  return rem > 0 ? rem : 0;
}

function clearWaitEndTime() {
  localStorage.removeItem(WAIT_KEY);
}

function formatTime(sec) {
  const h = Math.floor(sec / 3600),
        m = Math.floor((sec % 3600) / 60),
        s = sec % 60;
  if (h > 0) return `${h} ساعة ${m} دقيقة`;
  if (m > 0) return `${m} دقيقة ${s} ثانية`;
  return `${s} ثانية`;
}

function startRedirectCountdown() {
  let remaining = getRemainingWait();
  const el = document.getElementById('countdown');
  if (remaining <= 0) {
    el.innerText = 'يمكنك البدء الآن';
    return;
  }
  el.innerText = formatTime(Math.floor(remaining / 1000));
  const id = setInterval(() => {
    remaining = getRemainingWait();
    if (remaining <= 0) {
      clearInterval(id);
      clearWaitEndTime();
      el.innerText = 'يمكنك البدء الآن';
      // window.location.href = '/'; // اختياري: رجوع تلقائي
    } else {
      el.innerText = formatTime(Math.floor(remaining / 1000));
    }
  }, 1000);
}

startRedirectCountdown();
    </script>

<!-- 10 - الواجهة: زر البدء والتعامل مع الأحداث -->
<script>
  window.addEventListener('load', () => {
    const remaining = getRemainingWait();
    if (remaining > 0) {
    window.location.href = 'redirect.html';
    }
  });
</script>

<!-- A1 - دالة إرجاع قائمة الإعلانات (مصدر بسيط من companies) -->
<script>
// هذا كود: ترجمة كائن companies إلى مصفوفة من الكائنات {comp, url}
function getAdUrls() {
  const arr = [];
  for (const comp in companies) {
    const list = companies[comp] || [];
    for (const u of list) {
      arr.push({ comp, url: u });
    }
  }
  return arr;
}
</script>

<!-- A2 - دالة اختيار إعلان عشوائي من المصفوفة -->
<script>
// هذا كود: يختار إعلانًا عشوائيًا من المصفوفة (يعادله بنفس البنية {comp, url})
function pickRandomAd(urls) {
  if (!Array.isArray(urls) || urls.length === 0) return null;
  return urls[Math.floor(Math.random() * urls.length)];
}
</script>

<!-- A3 - دالة فتح الإعلان -->
<script>
// هذا كود: فتح الإعلان في تبويب جديد وتخزين النافذة في متغير عام
function openAd(url) {
  try {
    const win = window.open(url, '_blank', 'noopener,noreferrer');
    if (!win) {
      console.warn('Popup blocked or failed to open:', url);
      lastOpenedAdWin = null;
      return null;
    }
    lastOpenedAdWin = win;
    return win;
  } catch (e) {
    console.error('openAd error', e);
    lastOpenedAdWin = null;
    return null;
  }
}
</script>

<!-- A4 - تغليف استدعاءات المكافآت (يجمع المكالمات الثلاثة) -->
<script>
// هذا كود: يطالع دوال المكافآت (لو متوفرة) بطريقة آمنة
async function handleRewards() {
  await callAddRewardIfExists();
  await callAddWatchedAdIfExists();
  await callAddDailyRewardIfExists();
}
</script>

<!-- A5 - انتظار داخل الإعلان: يبقي التبويب مفتوح 10-17 ثانية ثم يغلقه -->
<script>
// هذا كود: يبقي الإعلان مفتوحًا مدة عشوائية (10-17s) ثم يغلق التبويب الأخير المفتوح
async function waitInsideAd() {
  // مدة العرض الفعلية (بملّي ثانية)
  const stayMs = randomMs(10, 17);
  await new Promise(res => setTimeout(res, stayMs));

  // محاولة إغلاق النافذة إن كانت موجودة
  try {
    if (lastOpenedAdWin && !lastOpenedAdWin.closed) {
      lastOpenedAdWin.close();
      lastOpenedAdWin = null;
    }
  } catch (e) {
    // لا توقف التنفيذ لو حصل خطأ cross-origin أو منع
    console.warn('Error closing ad window', e);
  }
}
</script>

<!-- A6 - الانتظار بين الإعلانات: استراحة قصيرة 0-4 ثواني -->
<script>
// هذا كود: استراحة قصيرة بين الإعلانات (0-4s)
function waitBetweenAds() {
  return new Promise(res => setTimeout(res, randomMs(0, 4)));
}
</script>

<!-- A7 - قرار متى تؤخذ الراحة القصيرة -->
<script>
// هذا كود: يحدد إن كان الوقت قد حان لأخذ راحة قصيرة (restEvery معرف في الوحدة العامة)
function shouldTakeShortBreak(batchCountParam) {
  if (typeof restEvery === 'undefined' || restEvery <= 0) return false;
  return (batchCountParam % restEvery) === 0;
}
</script>

<!-- A8 - تنفيذ الراحة القصيرة (استدعاء startCountdown والانتظار) -->

<script>
// راحة قصيرة: حفظ وقت الراحة ثم إعادة توجيه لصفحة redirect.html
async function takeShortBreak() {
  const waitTime = getRestPeriod(); // بالملّي ثانية
  // حفظ وقت الانتهاء
  saveWaitEndTime(waitTime);
  // (اختياري) إعادة ضبط restEvery الآن أو بعد العودة - هنا نعيد ضبطه الآن
  restEvery = randomInt(4, 8);
  // اخرج المستخدم لعرض العداد
  window.location.href = 'redirect.html';
}

// حظر طويل: حفظ وقت الحظر ثم إعادة توجيه لصفحة redirect.html
async function takeLongBan() {
  const waitTime = getBanPeriod(); // بالملّي ثانية
  saveWaitEndTime(waitTime);
  // إعادة ضبط القيم كما في تصميمك
  batchCount = 0;
  banEvery = randomInt(2, 5);
  restEvery = randomInt(4, 8);
  // إعادة توجيه لعرض العداد
  window.location.href = 'redirect.html';
  return;
}
</script>
<!-- A9 - قرار متى يؤخذ الحظر الطويل -->
<script>
// هذا كود: يحدد إن كان يجب تطبيق الحظر الطويل بناء على batchCount و banEvery
function shouldTakeLongBan(batchCountParam) {
  return batchCountParam >= banEvery;
}
</script>

<!-- A10 - تنفيذ الحظر الطويل -->


<!-- A11 - إعادة التوجيه بعد الانتهاء -->
<script>
// هذا كود: يعيد توجيه المستخدم لصفحة النهاية (يمكنك تغيير الرابط)
function redirectToEndPage() {
  window.location.href = 'redirect.html';
  return;
}
</script>

<!-- ========== الكود الأصلي القابل للتشغيل (mainAdFlow) - يجب أن يكون آخر شيء في الملف ========== -->

<script>
(async function mainAdFlow() {
  if (window.__adRunner?.isRunning) {
    console.warn('mainAdFlow already running, abort.');
    return;
  }
  window.__adRunner = window.__adRunner || {};
  window.__adRunner.isRunning = true;
  let __adsOpenedThisRun = 0;

  try {
    const urls = getAdUrls();
    for (let i = 0; i < 15; i++) {
      const ad = pickRandomAd(urls);
      if (!ad) continue;
      const win = openAd(ad.url);
      await handleRewards();
      await waitInsideAd();
      if (i < 15 - 1) await waitBetweenAds();

      __adsOpenedThisRun++;
      if (__adsOpenedThisRun >= 500) { // حاجز أمان بقيمة كبيرة
        console.error('Watchdog stop: opened too many ads');
        break;
      }
    }

    // بعد انتهاء الدفعة
    batchCount++;
    let waitTime = randomMs(3 * 60, 8 * 60);
    const hour = new Date().getHours();

    if (hour >= 1 && hour < 6) {
      waitTime += 50 * 60 * 1000;
    } else if (shouldTakeLongBan(batchCount)) {
      waitTime += getBanPeriod();
      batchCount = 0;
      banEvery = randomInt(2,5);
      restEvery = randomInt(4,8);
    } else if (shouldTakeShortBreak(batchCount)) {
      waitTime += getRestPeriod();
      restEvery = randomInt(4,8);
    }

    saveWaitEndTime(waitTime);
    window.location.href = 'redirect.html';
    return;
  } catch (e) {
    console.error('mainAdFlow error', e);
  } finally {
    window.__adRunner.isRunning = false;
  }
})();
</script>




       <!--    التخزين      -->



      
  
<script>
        //تخزين رصيد.المستخدم
async function addReward() {
  const user = firebase.auth().currentUser;
  if (!user) {
    console.error("لا يوجد مستخدم مسجل دخول!");
    return;
  }

  const uid = user.uid;
  const userRef = firebase.database().ref("users/" + uid + "/balance");

  try {
    const snapshot = await userRef.get();
    let balance = snapshot.exists() ? snapshot.val() : 0;

    balance = parseFloat(balance) + 0.1; // نزيد 0.1

    await userRef.set(balance); // نحفظه من جديد
    console.log("تم تحديث الرصيد:", balance);
  } catch (error) {
    console.error("خطأ أثناء تحديث الرصيد:", error);
  }
}
</script>

<script>
  // زيادة عدد الإعلانات التي شاهدها المستخدم
  async function addWatchedAd() {
    const user = firebase.auth().currentUser;
    if (!user) {
      console.error("لا يوجد مستخدم مسجل دخول!");
      return;
    }

    const uid = user.uid;
    const userRef = firebase.database().ref("users/" + uid + "/daywacted");

    try {
      const snapshot = await userRef.get();
      let count = snapshot.exists() ? snapshot.val() : 0;

      count = parseInt(count) + 1; // نزيد 1

      await userRef.set(count); // نحفظه من جديد
      console.log("تم تحديث عدد الإعلانات:", count);
    } catch (error) {
      console.error("خطأ أثناء تحديث عدد الإعلانات:", error);
    }
  }
</script>

<script>
  // زيادة أرباح اليوم من LocalStorage
  function addDailyReward() {
    const now = Date.now();

    // نجلب البيانات من localStorage
    let earningsData = JSON.parse(localStorage.getItem("earningsTodayData"));

    if (!earningsData) {
      // لا يوجد بيانات → نبدأ من جديد
      earningsData = { amount: 0, startTime: now };
    } else {
      // تحقق هل مرّ 24 ساعة
      const elapsed = now - earningsData.startTime;
      if (elapsed > 24 * 60 * 60 * 1000) { 
        // مر أكثر من يوم → إعادة تصفير
        earningsData = { amount: 0, startTime: now };
      }
    }

    // نزيد 0.1
    earningsData.amount = parseFloat(earningsData.amount) + 0.1;

    // نخزن من جديد
    localStorage.setItem("earningsTodayData", JSON.stringify(earningsData));

    console.log("أرباح اليوم الآن:", earningsData.amount.toFixed(2));
    return earningsData.amount;
  }
</script>


<script>
// 🧠 عشوائية للبصمة والتشويش الطبيعي

// ✅ Zoom عشوائي بين 95% و104%
document.body.style.zoom = (0.95 + Math.random() * 0.09).toFixed(2);

// ✅ حجم الخط يتغير بشكل طفيف
document.body.style.fontSize = `${Math.floor(14 + Math.random() * 3)}px`;

// ✅ لغة المتصفح تتغير بشكل خفيف
const langs = ['en-US', 'en-GB', 'fr-FR', 'ar-DZ'];
try {
  Object.defineProperty(navigator, 'language', {
    get: () => langs[Math.floor(Math.random() * langs.length)]
  });
} catch (e) {
  console.warn("لم يتم تعديل اللغة: " + e.message);
}

// ✅ Canvas fingerprint تشويش بسيط
try {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  ctx.textBaseline = "top";
  ctx.font = "14px Arial";
  ctx.fillStyle = "#f00";
  ctx.fillText("Test" + Math.random().toFixed(5), 10, 10);
} catch (e) {
  console.warn("Canvas spoofing failed: " + e.message);
}

// ✅ أبعاد الشاشة (Screen Size) تشويش بسيط
try {
  const randomOffset = () => Math.floor(Math.random() * 3) - 1; // -1 أو 0 أو +1
  Object.defineProperty(screen, 'width', {
    get: () => window.innerWidth + randomOffset()
  });
  Object.defineProperty(screen, 'height', {
    get: () => window.innerHeight + randomOffset()
  });
} catch (e) {
  console.warn("لم يتم تعديل أبعاد الشاشة: " + e.message);
}

// ✅ WebGL Fingerprint noise
try {
  const getParameter = WebGLRenderingContext.prototype.getParameter;
  WebGLRenderingContext.prototype.getParameter = function(parameter) {
    if (parameter === 37445 || parameter === 37446) {
      // vendor / renderer
      return "FakeWebGL-" + Math.random().toString(36).substring(2, 8);
    }
    return getParameter.apply(this, arguments);
  };
} catch (e) {
  console.warn("WebGL spoofing failed: " + e.message);
}

// ✅ AudioContext Fingerprint noise
try {
  const origGetChannelData = AudioBuffer.prototype.getChannelData;
  AudioBuffer.prototype.getChannelData = function() {
    const results = origGetChannelData.apply(this, arguments);
    for (let i = 0; i < results.length; i += 100) {
      results[i] = results[i] + (Math.random() * 0.0001 - 0.00005);
    }
    return results;
  };
} catch (e) {
  console.warn("Audio spoofing failed: " + e.message);
}

// ✅ تأخير بسيط في بدء التنفيذ (300-800ms)
const fingerprintDelay = Math.floor(Math.random() * 500) + 300;
setTimeout(() => {
  console.log("✅ Fingerprint noise applied.");
  // يمكنك هنا تشغيل أي شيء إضافي بعد التأخير
}, fingerprintDelay);

</script>
</body>
</html>
